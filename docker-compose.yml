
services:
  # Central router
  router:
    build:
      context: ./router
      dockerfile: Dockerfile
    ports:
      - "8000:8000"
    networks:
      - gpu-net
    environment:
      - LOG_LEVEL=INFO
      - NODE_URL=http://node:8005
      - NODE_API_KEY=secure-router-key-123
    depends_on:
      - node

  # SmolLM2 Node Service
  node:
    build:
      context: ./node
      dockerfile: Dockerfile
    ports:
      - "8005:8005"
    networks:
      - gpu-net
    environment:
      - MODEL_PATH=/models/HuggingFaceTB/SmolLM2-135M-Instruct
      - ROUTER_API_KEY=secure-router-key-123

networks:
  gpu-net:
    driver: bridge